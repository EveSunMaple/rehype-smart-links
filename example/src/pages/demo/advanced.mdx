import Layout from '../../layouts/Layout.astro'
import PageNavigation from '../../components/PageNavigation.astro'
import CodeExample from '../../components/CodeExample.astro'

<Layout title="é«˜çº§åŠŸèƒ½" description="rehype-smart-links é«˜çº§åŠŸèƒ½å’Œè‡ªå®šä¹‰é€‰é¡¹æ¼”ç¤º" activeTab="advanced">

# é«˜çº§åŠŸèƒ½æ¼”ç¤º

æœ¬é¡µé¢å±•ç¤ºäº† rehype-smart-links æ’ä»¶çš„é«˜çº§åŠŸèƒ½å’Œè‡ªå®šä¹‰é€‰é¡¹ã€‚

## è‡ªå®šä¹‰é“¾æ¥ç»“æ„

ä½¿ç”¨ `wrapperTemplate` é€‰é¡¹ï¼Œæ‚¨å¯ä»¥è‡ªå®šä¹‰é“¾æ¥çš„ HTML ç»“æ„ã€‚ä¾‹å¦‚ï¼Œæ·»åŠ å›¾æ ‡ã€çŠ¶æ€æŒ‡ç¤ºå™¨æˆ–å…¶ä»–å…ƒç´ ã€‚

<CodeExample
  title="è‡ªå®šä¹‰é“¾æ¥æ˜¾ç¤º"
  internalLinkHtml='<a href="/about" class="internal-link flex items-center">å…³äºé¡µé¢<span class="ml-1">ğŸ“„</span></a>'
  externalLinkHtml='<a href="https://astro.build" class="external-link flex items-center" target="_blank" rel="noopener noreferrer">Astroå®˜ç½‘<span class="ml-1">ğŸ”—</span></a>'
  brokenLinkHtml='<a href="/this-page-does-not-exist" class="broken-link flex items-center"><span class="mr-1">âš ï¸</span>æ–­å¼€é“¾æ¥</a>'
>
```js
// astro.config.mjs
import { defineConfig } from 'astro/config';
import rehypeSmartLinks from 'rehype-smart-links';
import { h } from 'hastscript';

export default defineConfig({
  markdown: {
    rehypePlugins: [[
      rehypeSmartLinks, 
      {
        // è‡ªå®šä¹‰é“¾æ¥æ¨¡æ¿
        wrapperTemplate: (node, linkType) => {
          if (linkType === 'internal') {
            // å†…éƒ¨é“¾æ¥æ·»åŠ æ–‡æ¡£å›¾æ ‡
            const icon = h('span', { className: 'ml-1' }, 'ğŸ“„');
            node.children.push(icon);
            node.properties.className = [
              ...(node.properties.className || []),
              'flex',
              'items-center'
            ];
          } else if (linkType === 'external') {
            // å¤–éƒ¨é“¾æ¥æ·»åŠ é“¾æ¥å›¾æ ‡
            const icon = h('span', { className: 'ml-1' }, 'ğŸ”—');
            node.children.push(icon);
            node.properties.className = [
              ...(node.properties.className || []),
              'flex',
              'items-center'
            ];
          } else if (linkType === 'broken') {
            // æ–­å¼€é“¾æ¥æ·»åŠ è­¦å‘Šå›¾æ ‡
            const icon = h('span', { className: 'mr-1' }, 'âš ï¸');
            node.children = [icon, ...node.children];
            node.properties.className = [
              ...(node.properties.className || []),
              'flex',
              'items-center'
            ];
          }
          return node;
        }
      }
    ]]
  }
});
```
</CodeExample>

## æ·»åŠ å¾½ç« 

æ‚¨å¯ä»¥ä½¿ç”¨ wrapperTemplate ä¸ºé“¾æ¥æ·»åŠ ä¸åŒæ ·å¼çš„å¾½ç« ï¼š

<CodeExample
  title="é“¾æ¥æ·»åŠ å¾½ç« "
  internalLinkHtml='<a href="/about" class="internal-link flex items-center gap-2">å…³äºé¡µé¢<span class="badge badge-primary badge-sm">å†…éƒ¨</span></a>'
  externalLinkHtml='<a href="https://astro.build" class="external-link flex items-center gap-2" target="_blank" rel="noopener noreferrer">Astroæ–‡æ¡£<span class="badge badge-secondary badge-sm">å¤–éƒ¨</span></a>'
  brokenLinkHtml='<a href="/non-existent" class="broken-link flex items-center gap-2">ä¸å­˜åœ¨é¡µé¢<span class="badge badge-error badge-sm">æ–­å¼€</span></a>'
>
```js
// astro.config.mjs
import { defineConfig } from 'astro/config';
import rehypeSmartLinks from 'rehype-smart-links';
import { h } from 'hastscript';

export default defineConfig({
  markdown: {
    rehypePlugins: [[
      rehypeSmartLinks, 
      {
        wrapperTemplate: (node, linkType) => {
          let badge;
          
          if (linkType === 'internal') {
            badge = h('span', { 
              className: 'badge badge-primary badge-sm'
            }, 'å†…éƒ¨');
          } else if (linkType === 'external') {
            badge = h('span', { 
              className: 'badge badge-secondary badge-sm'
            }, 'å¤–éƒ¨');
          } else if (linkType === 'broken') {
            badge = h('span', { 
              className: 'badge badge-error badge-sm'
            }, 'æ–­å¼€');
          }
          
          if (badge) {
            node.children.push(badge);
            node.properties.className = [
              ...(node.properties.className || []),
              'flex',
              'items-center',
              'gap-2'
            ];
          }
          
          return node;
        }
      }
    ]]
  }
});
```
</CodeExample>

## é“¾æ¥è½¬æ¢åŠŸèƒ½

ä½¿ç”¨ `transformLink` é€‰é¡¹å¯ä»¥ä¿®æ”¹é“¾æ¥çš„å±æ€§æˆ–å†…å®¹ï¼š

<CodeExample
  title="é“¾æ¥è½¬æ¢ç¤ºä¾‹"
  internalLinkHtml='<a href="/documentation/getting-started" class="internal-link" data-section="docs">å…¥é—¨æŒ‡å—</a>'
  externalLinkHtml='<a href="https://github.com" class="external-link github-link" target="_blank" rel="noopener noreferrer" data-external="true">GitHub</a>'
  brokenLinkHtml='<a href="/non-existent" class="broken-link" data-error="true" title="æ­¤é¡µé¢ä¸å­˜åœ¨">é”™è¯¯é“¾æ¥</a>'
>
```js
// astro.config.mjs
import { defineConfig } from 'astro/config';
import rehypeSmartLinks from 'rehype-smart-links';

export default defineConfig({
  markdown: {
    rehypePlugins: [[
      rehypeSmartLinks, 
      {
        transformLink: (node, linkType, url) => {
          // æ ¹æ®é“¾æ¥ç±»å‹å’ŒURLæ·»åŠ ç‰¹å®šå±æ€§
          if (linkType === 'internal') {
            // é‡å®šå‘æ–‡æ¡£é“¾æ¥
            if (url.startsWith('/docs/')) {
              node.properties.href = url.replace('/docs/', '/documentation/');
            }
            
            // æ·»åŠ æ•°æ®å±æ€§
            if (url.includes('getting-started')) {
              node.properties['data-section'] = 'docs';
            }
          } 
          else if (linkType === 'external') {
            // ä¸ºå¤–éƒ¨é“¾æ¥æ·»åŠ é¢å¤–å±æ€§
            node.properties['data-external'] = 'true';
            
            // ä¸ºç‰¹å®šç«™ç‚¹æ·»åŠ ç‰¹æ®Šç±»
            if (url.includes('github.com')) {
              node.properties.className = [
                ...(node.properties.className || []),
                'github-link'
              ];
            }
          }
          else if (linkType === 'broken') {
            // ä¸ºæ–­å¼€é“¾æ¥æ·»åŠ é”™è¯¯ä¿¡æ¯
            node.properties['data-error'] = 'true';
            node.properties.title = 'æ­¤é¡µé¢ä¸å­˜åœ¨';
          }
          
          return node;
        }
      }
    ]]
  }
});
```
</CodeExample>

## è‡ªå®šä¹‰é…ç½®é€‰é¡¹å®Œæ•´ç¤ºä¾‹

ä»¥ä¸‹æ˜¯ä¸€ä¸ªå®Œæ•´çš„é…ç½®ç¤ºä¾‹ï¼Œå±•ç¤ºäº†å¦‚ä½•ç»„åˆä½¿ç”¨å¤šç§è‡ªå®šä¹‰é€‰é¡¹ï¼š

```js
// astro.config.mjs
import { defineConfig } from 'astro/config';
import rehypeSmartLinks from 'rehype-smart-links';
import { h } from 'hastscript';

export default defineConfig({
  markdown: {
    rehypePlugins: [[
      rehypeSmartLinks, 
      {
        // åŸºæœ¬æ ·å¼ç±»
        internalLinkClass: 'custom-internal-link',
        brokenLinkClass: 'custom-broken-link',
        externalLinkClass: 'custom-external-link',
        
        // è·¯ç”±æ–‡ä»¶è·¯å¾„ï¼ˆä¸CLIç”Ÿæˆè·¯å¾„ä¸€è‡´ï¼‰
        routesFile: './.smart-links-routes.json',
        
        // æ˜¯å¦åŒ…å«æ‰€æœ‰æ–‡ä»¶ç±»å‹
        includeAllFiles: true,
        
        // å¤–éƒ¨é“¾æ¥å±æ€§
        externalLinkAttributes: {
          target: '_blank',
          rel: 'noopener noreferrer',
          'data-external': 'true'
        },
        
        // è‡ªå®šä¹‰é“¾æ¥ç»“æ„
        wrapperTemplate: (node, linkType, url) => {
          // ä¸ºå„ç±»é“¾æ¥æ·»åŠ å›¾æ ‡å’Œæ ·å¼
          // å®ç°ä»£ç ...
          return node;
        },
        
        // é“¾æ¥è½¬æ¢å‡½æ•°
        transformLink: (node, linkType, url) => {
          // æ ¹æ®URLæˆ–ç±»å‹ä¿®æ”¹é“¾æ¥å±æ€§
          // å®ç°ä»£ç ...
          return node;
        }
      }
    ]]
  }
});
```

## ä¸‹ä¸€æ­¥

æµè§ˆæ›´å¤šç¤ºä¾‹ï¼š

- [CSS è‡ªå®šä¹‰æ ·å¼](/demo/custom-css) - äº†è§£å¦‚ä½•ä½¿ç”¨ CSS è‡ªå®šä¹‰é“¾æ¥æ ·å¼
- [è‡ªå®šä¹‰å›¾æ ‡](/demo/custom-icon) - å­¦ä¹ å¦‚ä½•å‘é“¾æ¥æ·»åŠ è‡ªå®šä¹‰å›¾æ ‡

<PageNavigation currentPath="/demo/advanced" />

</Layout> 